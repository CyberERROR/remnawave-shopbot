{% for k in keys %}
<tr class="hover:bg-white/5">
    <td class="px-4 py-3 whitespace-nowrap text-sm text-white">#{{ k.key_id }}</td>
    <td class="px-4 py-3 whitespace-nowrap text-sm text-white">{{ k.user_id }}</td>
    <td class="px-4 py-3 whitespace-nowrap text-sm text-white">{{ k.host_name }}</td>
    <td class="px-4 py-3 whitespace-nowrap text-sm text-white">{{ k.key_email }}</td>
    <td class="px-4 py-3 text-sm text-white/70 max-w-[180px] truncate" title="{{ k.remnawave_user_uuid }}">{{
        k.remnawave_user_uuid }}</td>
    <td class="px-4 py-3 whitespace-nowrap text-sm">
        <span class="text-white">{{ k.expiry_date or '—' }}</span>
        {% if k.expiry_date %}
        <br><span class="text-white/50 text-xs">{{ k.expiry_date | relative_time(is_future=True) }}</span>
        {% endif %}
    </td>
    <td class="px-4 py-3 whitespace-nowrap text-sm">
        <span class="text-white">{{ k.created_date or '—' }}</span>
        {% if k.created_date %}
        <br><span class="text-white/50 text-xs">{{ k.created_date | relative_time(is_future=False) }}</span>
        {% endif %}
    </td>
    <td class="px-4 py-3 whitespace-nowrap">
        <div class="flex items-center gap-1.5">
            {% if k.user_id %}
            <a href="{{ url_for('users_page', q=k.user_id) }}"
                class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-white/10 text-white/50 hover:bg-white/20 hover:text-white transition-colors"
                title="Профиль">
                <span class="material-symbols-outlined text-base">person</span>
            </a>
            {% endif %}
            <button type="button"
                class="btn-edit-comment inline-flex items-center justify-center w-8 h-8 rounded-lg bg-white/10 text-white/70 hover:bg-white/20"
                data-key-id="{{ k.key_id }}" data-current-comment="{{ (k.comment or k.description or '')|e }}"
                title="Комментарий">
                <span class="material-symbols-outlined text-base">comment</span>
            </button>
            <button type="button"
                class="btn-open-expiry inline-flex items-center justify-center w-8 h-8 rounded-lg bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30"
                data-key-id="{{ k.key_id }}" title="Изменить срок">
                <span class="material-symbols-outlined text-base">schedule</span>
            </button>
            <form action="{{ url_for('delete_key_route', key_id=k.key_id) }}" method="post" class="inline"
                data-confirm="Удалить ключ #{{ k.key_id }}?">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button type="submit"
                    class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30"
                    title="Удалить">
                    <span class="material-symbols-outlined text-base">delete</span>
                </button>
            </form>
        </div>
    </td>
</tr>
{% if k.comment or k.description %}
<tr class="bg-white/[0.02]">
    <td colspan="8" class="px-4 py-2 text-white/50 text-sm">
        <span class="material-symbols-outlined text-base mr-1 align-middle">comment</span>
        {{ k.comment or k.description }}
    </td>
</tr>
{% endif %}
{% endfor %}