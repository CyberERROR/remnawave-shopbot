<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-sky-500/5 rounded-full blur-2xl group-hover:bg-sky-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Пользователей</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('user_count') is not none %}
                {{ stats.user_count }}
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-sky-500/10 flex items-center justify-center text-sky-400 border border-sky-500/10 shadow-[0_0_15px_rgba(56,189,248,0.2)]">
            <span class="material-symbols-outlined text-xl">group</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-blue-500/5 rounded-full blur-2xl group-hover:bg-blue-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Ключей</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('total_keys') is not none %}
                {{ stats.total_keys }}
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 border border-blue-500/10 shadow-[0_0_15px_rgba(59,130,246,0.2)]">
            <span class="material-symbols-outlined text-xl">vpn_key</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-green-500/5 rounded-full blur-2xl group-hover:bg-green-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Заработано</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('total_spent') is not none %}
                {{ "{:,.0f}".format(stats.total_spent).replace(",", " ") }} ₽
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center text-green-400 border border-green-500/10 shadow-[0_0_15px_rgba(34,197,94,0.2)]">
            <span class="material-symbols-outlined text-xl">payments</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-yellow-500/5 rounded-full blur-2xl group-hover:bg-yellow-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Серверов</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('host_count') is not none %}
                {{ stats.host_count }}
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-yellow-500/10 flex items-center justify-center text-yellow-400 border border-yellow-500/10 shadow-[0_0_15px_rgba(234,179,8,0.2)]">
            <span class="material-symbols-outlined text-xl">dns</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-red-500/5 rounded-full blur-2xl group-hover:bg-red-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Тикеты</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if open_tickets_count is not none %}
                {{ open_tickets_count }}
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-red-500/10 flex items-center justify-center text-red-500 border border-red-500/10 shadow-[0_0_15px_rgba(239,68,68,0.2)]">
            <span class="material-symbols-outlined text-xl">confirmation_number</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300 payment-stat-block">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-indigo-500/5 rounded-full blur-2xl group-hover:bg-indigo-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">YooKassa</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('yookassa_income') is not none %}
                {{ "{:,.0f}".format(stats.get('yookassa_income', 0)).replace(",", " ") }} ₽
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-indigo-500/10 flex items-center justify-center text-indigo-400 border border-indigo-500/10 shadow-[0_0_15px_rgba(99,102,241,0.2)]">
            <span class="material-symbols-outlined text-xl">account_balance_wallet</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300 payment-stat-block">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-cyan-500/5 rounded-full blur-2xl group-hover:bg-cyan-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">Platega</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('platega_income') is not none %}
                {{ "{:,.0f}".format(stats.get('platega_income', 0)).replace(",", " ") }} ₽
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-cyan-500/10 flex items-center justify-center text-cyan-400 border border-cyan-500/10 shadow-[0_0_15px_rgba(6,182,212,0.2)]">
            <span class="material-symbols-outlined text-xl">credit_card</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300 payment-stat-block">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-amber-500/5 rounded-full blur-2xl group-hover:bg-amber-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">TG Stars</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('stars_income') is not none %}
                {{ "{:,.0f}".format(stats.get('stars_income', 0)).replace(",", " ") }} ₽
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 border border-amber-500/10 shadow-[0_0_15px_rgba(245,158,11,0.2)]">
            <span class="material-symbols-outlined text-xl">grade</span>
        </div>
    </div>
</div>

<div
    class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300 payment-stat-block">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-violet-500/5 rounded-full blur-2xl group-hover:bg-violet-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex items-start justify-between">
        <div>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-2">CryptoBot</p>
            <h4 class="text-3xl font-bold text-white tracking-tight">
                {% if stats.get('cryptobot_income') is not none %}
                {{ "{:,.0f}".format(stats.get('cryptobot_income', 0)).replace(",", " ") }} ₽
                {% else %}
                <span
                    class="animate-spin inline-block h-6 w-6 border-2 border-white/20 border-t-white rounded-full"></span>
                {% endif %}
            </h4>
        </div>
        <div
            class="w-10 h-10 rounded-xl bg-violet-500/10 flex items-center justify-center text-violet-400 border border-violet-500/10 shadow-[0_0_15px_rgba(139,92,246,0.2)]">
            <span class="material-symbols-outlined text-xl">currency_bitcoin</span>
        </div>
    </div>
</div>

<div class="relative overflow-hidden bg-white/5 border border-white/10 rounded-2xl p-5 group hover:border-white/20 transition-all duration-300 payment-stat-block"
    id="toggle-stats-card">
    <div
        class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-emerald-500/5 rounded-full blur-2xl group-hover:bg-emerald-500/10 transition-colors">
    </div>
    <div class="relative z-10 flex flex-col h-full">
        <div class="flex items-start justify-between">
            <div id="view-stat-heleket" class="stat-view">
                <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-1">Heleket</p>
                <h4 class="text-2xl font-bold text-white tracking-tight">
                    {% if stats.get('heleket_income') is not none %}
                    {{ "{:,.0f}".format(stats.get('heleket_income', 0)).replace(",", " ") }} ₽
                    {% else %}
                    <span
                        class="animate-spin inline-block h-4 w-4 border-2 border-white/20 border-t-white rounded-full"></span>
                    {% endif %}
                </h4>
            </div>

            <div id="view-stat-ton" class="stat-view hidden">
                <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-1">TonConnect</p>
                <h4 class="text-2xl font-bold text-white tracking-tight text-emerald-400">
                    {% if stats.get('tonconnect_income') is not none %}
                    {{ "{:,.0f}".format(stats.get('tonconnect_income', 0)).replace(",", " ") }} ₽
                    {% else %}
                    <span
                        class="animate-spin inline-block h-4 w-4 border-2 border-white/20 border-t-white rounded-full"></span>
                    {% endif %}
                </h4>
            </div>

            <button onclick="toggleStat(event)"
                class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 border border-emerald-500/10 shadow-[0_0_15px_rgba(16,185,129,0.2)] hover:bg-emerald-500/20 transition-all duration-300">
                <span class="material-symbols-outlined text-xl" id="toggle-stat-icon">payments</span>
            </button>
        </div>
    </div>

    <script>
        (function () {
            const current = localStorage.getItem('dashboard_toggle_stat') || 'heleket';
            applyToggleStat(current);
        })();

        window.toggleStat = function (event) {
            if (event) event.stopPropagation();
            const current = localStorage.getItem('dashboard_toggle_stat') || 'heleket';
            const next = current === 'heleket' ? 'ton' : 'heleket';
            localStorage.setItem('dashboard_toggle_stat', next);
            applyToggleStat(next);
        };

        function applyToggleStat(mode) {
            const hView = document.getElementById('view-stat-heleket');
            const tView = document.getElementById('view-stat-ton');
            const icon = document.getElementById('toggle-stat-icon');

            if (!hView || !tView) return;

            if (mode === 'heleket') {
                hView.classList.remove('hidden');
                tView.classList.add('hidden');
                if (icon) icon.innerText = 'payments';
            } else {
                hView.classList.add('hidden');
                tView.classList.remove('hidden');
                if (icon) icon.innerText = 'account_balance_wallet';
            }
        }
    </script>
</div>