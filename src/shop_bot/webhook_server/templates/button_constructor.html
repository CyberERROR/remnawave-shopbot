{% extends "base.html" %}
{% block title %}–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–Ω–æ–ø–æ–∫{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-6">
    <h2 class="text-2xl font-bold text-white">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–Ω–æ–ø–æ–∫</h2>
    <p class="text-white/50 text-sm">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –±–æ—Ç–∞</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Grid -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Button Grid -->
        <div class="bg-white/5 border border-white/10 rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-white font-bold">–ö–Ω–æ–ø–∫–∏</h3>
                <div class="flex gap-2">
                    <button type="button" id="add-button-btn"
                        class="px-3 py-1.5 rounded-lg bg-primary/20 text-primary text-sm font-medium hover:bg-primary/30 flex items-center gap-1">
                        <span class="material-symbols-outlined text-base">add</span> –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                    <button type="button" id="save-layout-btn"
                        class="px-3 py-1.5 rounded-lg bg-white/10 text-white text-sm font-medium hover:bg-white/20 flex items-center gap-1">
                        <span class="material-symbols-outlined text-base">save</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" id="preview-btn"
                        class="px-3 py-1.5 rounded-lg bg-blue-500/20 text-blue-400 text-sm font-medium hover:bg-blue-500/30 flex items-center gap-1">
                        <span class="material-symbols-outlined text-base">visibility</span> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                    </button>
                </div>
            </div>
            <div class="mb-4">
                <label class="block text-white/70 text-sm mb-2">–¢–∏–ø –º–µ–Ω—é:</label>
                <div class="mb-4">
                    <label class="block text-white/70 text-sm mb-2">–¢–∏–ø –º–µ–Ω—é:</label>
                    <div class="soft-select" data-target="menu-type-select">
                        <button type="button" class="soft-select-toggle">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
                        <div class="soft-select-menu"></div>
                        <select id="menu-type-select" class="hidden">
                            <option value="main_menu">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</option>
                            <option value="admin_menu">–ê–¥–º–∏–Ω –º–µ–Ω—é</option>
                            <option value="profile_menu">–ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è</option>
                            <option value="support_menu">–ú–µ–Ω—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="button-grid"
                class="grid grid-cols-2 gap-3 min-h-[300px] p-4 border-2 border-dashed border-white/20 rounded-lg bg-white/[0.02]">
            </div>
        </div>

        <!-- Hidden Buttons -->
        <div class="bg-white/5 border border-white/10 rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-white font-bold">–°–∫—Ä—ã—Ç—ã–µ –∫–Ω–æ–ø–∫–∏</h3>
                <span class="text-white/50 text-sm">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∏—Ö</span>
            </div>
            <div id="hidden-button-grid"
                class="grid grid-cols-2 gap-3 min-h-[100px] p-4 border-2 border-dashed border-white/10 rounded-lg bg-white/[0.01]">
            </div>
        </div>
    </div>

    <!-- Properties Panel -->
    <div class="space-y-6">
        <div class="bg-white/5 border border-white/10 rounded-lg p-6">
            <h3 class="text-white font-bold mb-4">–°–≤–æ–π—Å—Ç–≤–∞ –∫–Ω–æ–ø–∫–∏</h3>
            <form id="button-properties-form" class="space-y-4">
                <div>
                    <label class="block text-white/70 text-sm mb-2">ID –∫–Ω–æ–ø–∫–∏:</label>
                    <input type="text" id="button-id" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
                </div>
                <div>
                    <label class="block text-white/70 text-sm mb-2">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏:</label>
                    <input type="text" id="button-text" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
                </div>
                <div>
                    <label class="block text-white/70 text-sm mb-2">–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è:</label>
                    <div class="soft-select" data-target="action-type">
                        <button type="button" class="soft-select-toggle">Callback (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ)</button>
                        <div class="soft-select-menu"></div>
                        <select id="action-type" class="hidden">
                            <option value="callback">Callback (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ)</option>
                            <option value="url">URL (–≤–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞)</option>
                        </select>
                    </div>
                </div>
                <div id="callback-data-group">
                    <label class="block text-white/70 text-sm mb-2">Callback Data:</label>
                    <input type="text" id="callback-data" placeholder="callback_data"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
                </div>
                <div id="url-group" class="hidden">
                    <label class="block text-white/70 text-sm mb-2">URL:</label>
                    <input type="url" id="button-url" placeholder="https://example.com"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white/70 text-sm mb-2">–°—Ç—Ä–æ–∫–∞:</label>
                        <input type="number" id="row-position" min="0" value="0"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white" />
                    </div>
                    <div>
                        <label class="block text-white/70 text-sm mb-2">–ö–æ–ª–æ–Ω–∫–∞:</label>
                        <input type="number" id="column-position" min="0" value="0"
                            class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white" />
                    </div>
                </div>
                <div>
                    <label class="block text-white/70 text-sm mb-2">–®–∏—Ä–∏–Ω–∞:</label>
                    <div class="soft-select" data-target="button-width">
                        <button type="button" class="soft-select-toggle">1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)</button>
                        <div class="soft-select-menu"></div>
                        <select id="button-width" class="hidden">
                            <option value="1">1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)</option>
                            <option value="2">2 –∫–æ–ª–æ–Ω–∫–∏ (—à–∏—Ä–æ–∫–∞—è)</option>
                            <option value="3">3 –∫–æ–ª–æ–Ω–∫–∏ (–æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∞—è)</option>
                        </select>
                    </div>
                    <p class="text-white/40 text-xs mt-1">–®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥—Ä—É–≥–∏—Ö</p>
                </div>
                <div>
                    <label class="block text-white/70 text-sm mb-2">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:</label>
                    <input type="number" id="sort-order" min="0" value="0"
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white" />
                </div>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="is-active" checked
                        class="w-4 h-4 bg-white/10 border-white/20 rounded text-primary focus:ring-primary/50" />
                    <span class="text-white/70 text-sm">–ê–∫—Ç–∏–≤–Ω–∞</span>
                </label>
                <div class="pt-2 space-y-2">
                    <button type="submit"
                        class="w-full px-4 py-2.5 rounded-lg bg-primary text-background-dark font-bold hover:bg-primary/90 transition-colors">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                    <button type="button" id="delete-button-btn"
                        class="hidden w-full px-4 py-2.5 rounded-lg bg-red-500/20 text-red-400 font-medium hover:bg-red-500/30 transition-colors">
                        <span class="material-symbols-outlined text-base align-middle">delete</span> –£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫—É
                    </button>
                </div>
            </form>
        </div>

        <!-- Preview -->
        <div class="bg-white/5 border border-white/10 rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-white font-bold">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
                <div class="flex gap-1">
                    <button type="button" id="refresh-preview-btn"
                        class="px-2 py-1 rounded bg-white/10 text-white/70 hover:bg-white/20" title="–û–±–Ω–æ–≤–∏—Ç—å">
                        <span class="material-symbols-outlined text-base">refresh</span>
                    </button>
                    <button type="button" id="clear-preview-btn"
                        class="px-2 py-1 rounded bg-white/10 text-white/70 hover:bg-white/20" title="–û—á–∏—Å—Ç–∏—Ç—å">
                        <span class="material-symbols-outlined text-base">close</span>
                    </button>
                </div>
            </div>
            <div id="preview-area" class="telegram-preview">
                <p class="text-white/50 text-center text-sm">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–Ω–æ–ø–æ–∫</p>
            </div>
        </div>
    </div>
</div>

<!-- Add Button Modal -->
<div id="addButtonModal" class="modal-overlay">
    <div class="modal-content">
        <div class="p-4 border-b border-white/10 flex items-center justify-between">
            <h5 class="text-white font-bold">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É</h5>
            <button onclick="closeModal('addButtonModal')" class="text-white/50 hover:text-white">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="p-6 space-y-4">
            <div>
                <label class="block text-white/70 text-sm mb-2">ID –∫–Ω–æ–ø–∫–∏:</label>
                <input type="text" id="new-button-id" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID" required
                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
            </div>
            <div>
                <label class="block text-white/70 text-sm mb-2">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏:</label>
                <input type="text" id="new-button-text" placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏" required
                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
            </div>
            <div>
                <label class="block text-white/70 text-sm mb-2">–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è:</label>
                <div class="soft-select" data-target="new-action-type">
                    <button type="button" class="soft-select-toggle">Callback</button>
                    <div class="soft-select-menu"></div>
                    <select id="new-action-type" class="hidden">
                        <option value="callback">Callback</option>
                        <option value="url">URL</option>
                    </select>
                </div>
            </div>
            <div id="new-callback-data-group">
                <label class="block text-white/70 text-sm mb-2">Callback Data:</label>
                <input type="text" id="new-callback-data" placeholder="callback_data"
                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
            </div>
            <div id="new-url-group" class="hidden">
                <label class="block text-white/70 text-sm mb-2">URL:</label>
                <input type="url" id="new-button-url" placeholder="https://example.com"
                    class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-white placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50" />
            </div>
            <div>
                <label class="block text-white/70 text-sm mb-2">–®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏:</label>
                <div class="soft-select" data-target="new-button-width">
                    <button type="button" class="soft-select-toggle">1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)</button>
                    <div class="soft-select-menu"></div>
                    <select id="new-button-width" class="hidden">
                        <option value="1">1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)</option>
                        <option value="2">2 –∫–æ–ª–æ–Ω–∫–∏ (—à–∏—Ä–æ–∫–∞—è)</option>
                        <option value="3">3 –∫–æ–ª–æ–Ω–∫–∏ (–æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∞—è)</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="p-4 border-t border-white/10 flex justify-end gap-2">
            <button onclick="closeModal('addButtonModal')"
                class="px-4 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20">–û—Ç–º–µ–Ω–∞</button>
            <button id="confirm-add-button"
                class="px-4 py-2 rounded-lg bg-primary text-background-dark font-bold hover:bg-primary/90">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<style>
    .button-item {
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        cursor: move;
        transition: all 0.2s;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        min-height: 44px;
    }

    .button-item .button-text {
        font-size: 0.875rem;
        line-height: 1.2;
    }

    .button-item .button-id {
        font-size: 0.65rem;
        opacity: 0.5;
    }

    .button-item .button-width-indicator {
        font-size: 0.6rem;
        margin-top: 2px;
    }

    .button-item:hover {
        border-color: rgba(var(--primary-rgb), 0.5);
    }

    .button-item.selected {
        background: rgba(var(--primary-rgb), 0.2);
        border-color: var(--primary);
    }

    .button-item.width-1 {
        grid-column: span 1;
    }

    .button-item.width-2 {
        grid-column: span 2;
    }

    .button-item.width-3 {
        grid-column: span 2;
    }

    .button-item .button-actions {
        position: absolute;
        top: 0.25rem;
        right: 0.25rem;
        opacity: 0;
        transition: opacity 0.2s;
        display: flex;
        gap: 0.125rem;
    }

    .button-item .button-actions button {
        padding: 0.125rem;
    }

    .button-item:hover .button-actions {
        opacity: 1;
    }

    .sortable-ghost {
        opacity: 0.4;
    }

    .sortable-chosen {
        transform: rotate(3deg);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    /* Telegram-style preview - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    .telegram-preview {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 12px;
        padding: 16px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 400px;
        margin: 0 auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        border: 1px solid #333;
        position: relative;
        overflow: hidden;
    }

    .telegram-preview::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    }

    .telegram-header {
        margin-bottom: 16px;
    }

    .telegram-title {
        font-size: 18px;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 4px;
    }

    .telegram-subtitle {
        font-size: 14px;
        color: #8e8e93;
    }

    .telegram-button-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .telegram-button-row {
        display: flex;
        gap: 8px;
        width: 100%;
    }

    .telegram-button {
        background: linear-gradient(135deg, #3a3a3c 0%, #2c2c2e 100%);
        border: 1px solid #4a4a4c;
        border-radius: 8px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
        flex-grow: 0;
        flex-basis: auto;
        position: relative;
        overflow: hidden;
    }

    .telegram-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.3s ease;
    }

    .telegram-button:hover::before {
        left: 100%;
    }

    .telegram-button:hover {
        background: linear-gradient(135deg, #4a4a4c 0%, #3a3a3c 100%);
        border-color: #5a5a5c;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }

    .telegram-button:active {
        transform: translateY(0);
        background: linear-gradient(135deg, #2a2a2c 0%, #1a1a1c 100%);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .telegram-button-content {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        gap: 8px;
    }

    .telegram-button-text {
        color: #ffffff;
        font-size: 14px;
        font-weight: 600;
        text-align: center;
        line-height: 1.2;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .telegram-button-url {
        font-size: 12px;
        opacity: 0.8;
        color: #4fc3f7;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .telegram-button-width {
        font-size: 10px;
        opacity: 0.8;
        background: rgba(79, 195, 247, 0.2);
        color: #4fc3f7;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 4px;
        border: 1px solid rgba(79, 195, 247, 0.3);
        font-weight: 600;
    }

    /* Responsive –¥–ª—è preview */
    @media (max-width: 480px) {
        .telegram-preview {
            max-width: 100%;
            margin: 0;
            padding: 12px;
        }

        .telegram-button {
            padding: 10px 12px;
            min-height: 40px;
        }

        .telegram-button-text {
            font-size: 13px;
        }

        .telegram-button-width {
            font-size: 9px;
            padding: 1px 4px;
        }
    }

    /* Loading indicator */
    .preview-loading {
        text-align: center;
        padding: 20px;
    }

    .preview-loading .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 10px;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .soft-select-item {
        padding: 0.625rem 1rem;
        color: white;
        cursor: pointer;
        transition: background 0.2s;
    }

    .soft-select-item:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .soft-select-item.is-active {
        background: rgba(var(--primary-rgb), 0.2);
        color: var(--primary);
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
    class ButtonConstructor {
        constructor() {
            this.currentMenuType = 'main_menu';
            this.selectedButton = null;
            this.buttons = [];
            this.isPreviewLoading = false;
            this.init();
        }

        init() {
            this.initSoftSelects();
            this.bindEvents();
            this.loadButtons();
            this.disableLogoutButton();
        }

        // –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        disableLogoutButton() {
            const logoutButton = document.querySelector('form[action*="logout"] button[type="submit"]');
            if (logoutButton) {
                logoutButton.disabled = true;
                logoutButton.title = '–ö–Ω–æ–ø–∫–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞';
                logoutButton.style.opacity = '0.5';
                logoutButton.style.cursor = 'not-allowed';
            }
        }

        initSoftSelects() {
            if (window.initSoftSelect) {
                window.initSoftSelect('menu-type-select', '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é');
                window.initSoftSelect('action-type', 'Callback (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ)');
                window.initSoftSelect('button-width', '1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)');
                window.initSoftSelect('new-action-type', 'Callback');
                window.initSoftSelect('new-button-width', '1 –∫–æ–ª–æ–Ω–∫–∞ (–æ–±—ã—á–Ω–∞—è)');
            }
        }

        bindEvents() {
            document.getElementById('menu-type-select').addEventListener('change', (e) => {
                this.currentMenuType = e.target.value;
                this.selectedButton = null;
                this.loadButtons();
            });

            document.getElementById('add-button-btn').addEventListener('click', () => this.showAddModal());
            document.getElementById('save-layout-btn').addEventListener('click', () => this.saveLayout());
            document.getElementById('preview-btn').addEventListener('click', () => this.showPreview());
            document.getElementById('refresh-preview-btn').addEventListener('click', () => this.showPreview());
            document.getElementById('clear-preview-btn').addEventListener('click', () => this.clearPreview());

            document.getElementById('button-properties-form').addEventListener('submit', (e) => {
                e.preventDefault();
                this.saveButtonProperties();
            });

            document.getElementById('action-type').addEventListener('change', (e) => this.toggleActionFields(e.target.value));
            document.getElementById('new-action-type').addEventListener('change', (e) => this.toggleNewActionFields(e.target.value));
            document.getElementById('delete-button-btn').addEventListener('click', () => this.deleteButton());
            document.getElementById('confirm-add-button').addEventListener('click', () => this.addNewButton());

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            document.getElementById('button-width').addEventListener('change', (e) => {
                this.updateButtonWidthPreview(parseInt(e.target.value));
            });
        }

        async loadButtons() {
            try {
                const resp = await fetch(`/api/button-configs/${this.currentMenuType}`, { headers: { 'X-CSRFToken': getCsrfToken() } });
                const result = await resp.json();
                this.buttons = result.success ? (result.data || []) : [];
                this.renderButtons();
            } catch (e) {
                console.error('Error loading buttons:', e);
                this.buttons = [];
                this.renderButtons();
            }
        }

        renderButtons() {
            const grid = document.getElementById('button-grid');
            const hiddenGrid = document.getElementById('hidden-button-grid');
            grid.innerHTML = '';
            hiddenGrid.innerHTML = '';

            if (this.buttons.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center text-white/50 py-8">–ù–µ—Ç –∫–Ω–æ–ø–æ–∫. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è.</div>';
                hiddenGrid.innerHTML = '<div class="col-span-2 text-center text-white/30 py-4">–ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫</div>';
                return;
            }

            const sorted = [...this.buttons].sort((a, b) => {
                if (a.row_position !== b.row_position) return a.row_position - b.row_position;
                if (a.column_position !== b.column_position) return a.column_position - b.column_position;
                return (a.sort_order || 0) - (b.sort_order || 0);
            });

            sorted.forEach(btn => {
                const el = this.createButtonElement(btn);
                if (btn.is_active === 1 || btn.is_active === true) {
                    grid.appendChild(el);
                } else {
                    hiddenGrid.appendChild(el);
                }
            });

            if (!grid.children.length) grid.innerHTML = '<div class="col-span-2 text-center text-white/50 py-8">–ù–µ—Ç –≤–∏–¥–∏–º—ã—Ö –∫–Ω–æ–ø–æ–∫</div>';
            if (!hiddenGrid.children.length) hiddenGrid.innerHTML = '<div class="col-span-2 text-center text-white/30 py-4">–ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫</div>';

            this.initSortable();
        }

        createButtonElement(btn) {
            const div = document.createElement('div');
            div.className = 'button-item';
            div.dataset.buttonId = btn.id;

            const width = btn.button_width || 1;
            div.classList.add(`width-${width}`);
            if (this.selectedButton && this.selectedButton.id === btn.id) div.classList.add('selected');

            div.innerHTML = `
            <div class="button-text text-white font-medium mb-1">${btn.text || btn.button_id}</div>
            <div class="button-id text-white/50 text-xs">${btn.button_id}</div>
            <div class="button-width-indicator text-primary text-xs mt-1">${width}√ó</div>
            <div class="button-actions">
                <button type="button" class="p-1 rounded bg-white/10 hover:bg-white/20 text-white/70" onclick="buttonConstructor.editButton(${btn.id})">
                    <span class="material-symbols-outlined text-sm">edit</span>
                </button>
                <button type="button" class="p-1 rounded bg-red-500/20 hover:bg-red-500/30 text-red-400" onclick="buttonConstructor.deleteButton(${btn.id})">
                    <span class="material-symbols-outlined text-sm">delete</span>
                </button>
            </div>
        `;

            div.addEventListener('click', (e) => { if (!e.target.closest('.button-actions')) this.selectButton(btn.id); });
            return div;
        }

        initSortable() {
            const grid = document.getElementById('button-grid');
            const hiddenGrid = document.getElementById('hidden-button-grid');

            if (grid.children.length && !grid.querySelector('.text-center')) {
                new Sortable(grid, { group: 'buttons', animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: () => this.updateButtonPositions() });
            }
            if (hiddenGrid.children.length && !hiddenGrid.querySelector('.text-center')) {
                new Sortable(hiddenGrid, { group: 'buttons', animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: () => this.updateButtonPositions() });
            }
        }

        updateButtonPositions() {
            const grid = document.getElementById('button-grid');
            const hiddenGrid = document.getElementById('hidden-button-grid');
            const buttonOrders = [];

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
            const rows = [];
            let currentRow = [];
            let currentRowWidth = 0;

            Array.from(grid.querySelectorAll('.button-item')).forEach((el, idx) => {
                const id = parseInt(el.dataset.buttonId);
                const btn = this.buttons.find(b => b.id === id);
                if (!btn) return;

                let buttonWidth = 1;
                if (el.classList.contains('width-1')) buttonWidth = 1;
                else if (el.classList.contains('width-2')) buttonWidth = 2;
                else if (el.classList.contains('width-3')) buttonWidth = 3;
                else buttonWidth = btn.button_width || 1;

                btn.button_width = buttonWidth;
                btn.is_active = 1;

                if (buttonWidth === 3 || currentRowWidth + buttonWidth > 2) {
                    if (currentRow.length > 0) rows.push(currentRow);
                    currentRow = [];
                    currentRowWidth = 0;
                }

                currentRow.push({ element: el, button: btn, width: buttonWidth });
                currentRowWidth += buttonWidth;
            });

            if (currentRow.length > 0) rows.push(currentRow);

            rows.forEach((row, rowIndex) => {
                let columnIndex = 0;
                row.forEach(({ button, width }) => {
                    buttonOrders.push({
                        button_id: button.button_id,
                        sort_order: buttonOrders.length,
                        row_position: rowIndex,
                        column_position: columnIndex,
                        button_width: width,
                        is_active: 1
                    });
                    columnIndex += width;
                });
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö –∫–Ω–æ–ø–æ–∫
            Array.from(hiddenGrid.querySelectorAll('.button-item')).forEach((el, idx) => {
                const id = parseInt(el.dataset.buttonId);
                const btn = this.buttons.find(b => b.id === id);
                if (!btn) return;

                btn.is_active = 0;
                buttonOrders.push({
                    button_id: btn.button_id,
                    sort_order: buttonOrders.length,
                    row_position: 0,
                    column_position: 0,
                    button_width: btn.button_width || 1,
                    is_active: 0
                });
            });

            this.saveButtonOrders(buttonOrders);
            this.updateButtonWidthClasses();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –∫–Ω–æ–ø–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        updateButtonWidthPreview(newWidth) {
            if (!this.selectedButton) return;

            const buttonElement = document.querySelector(`[data-button-id="${this.selectedButton.id}"]`);
            if (!buttonElement) return;

            buttonElement.classList.remove('width-1', 'width-2', 'width-3');
            buttonElement.classList.add(`width-${newWidth}`);
            this.selectedButton.button_width = newWidth;

            const widthIndicator = buttonElement.querySelector('.button-width-indicator');
            if (widthIndicator) widthIndicator.textContent = `${newWidth}√ó`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CSS –∫–ª–∞—Å—Å–æ–≤ —à–∏—Ä–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        updateButtonWidthClasses() {
            this.buttons.forEach(button => {
                const buttonElement = document.querySelector(`[data-button-id="${button.id}"]`);
                if (buttonElement) {
                    buttonElement.classList.remove('width-1', 'width-2', 'width-3');
                    const width = button.button_width || 1;
                    buttonElement.classList.add(`width-${width}`);

                    const widthIndicator = buttonElement.querySelector('.button-width-indicator');
                    if (widthIndicator) widthIndicator.textContent = `${width}√ó`;
                }
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∫–Ω–æ–ø–æ–∫ —á–µ—Ä–µ–∑ API reorder
        async saveButtonOrders(buttonOrders) {
            try {
                const response = await fetch(`/api/button-configs/${this.currentMenuType}/reorder`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
                    body: JSON.stringify({ button_orders: buttonOrders })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('success', '–ü–æ—Ä—è–¥–æ–∫ –∫–Ω–æ–ø–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    await this.loadButtons();
                } else {
                    showToast('danger', '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞: ' + result.error);
                }
            } catch (error) {
                console.error('Error saving button orders:', error);
                showToast('danger', '–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        selectButton(buttonId) {
            document.querySelectorAll('.button-item').forEach(el => el.classList.remove('selected'));
            const element = document.querySelector(`[data-button-id="${buttonId}"]`);
            if (element) element.classList.add('selected');

            this.selectedButton = this.buttons.find(b => b.id === buttonId);
            if (this.selectedButton) this.loadButtonProperties();
        }

        editButton(buttonId) { this.selectButton(buttonId); }

        loadButtonProperties() {
            if (!this.selectedButton) return;
            const btn = this.selectedButton;

            document.getElementById('button-id').value = btn.button_id || '';
            document.getElementById('button-text').value = btn.text || '';
            document.getElementById('action-type').value = btn.url ? 'url' : 'callback';
            document.getElementById('callback-data').value = btn.callback_data || '';
            document.getElementById('button-url').value = btn.url || '';
            document.getElementById('row-position').value = btn.row_position || 0;
            document.getElementById('column-position').value = btn.column_position || 0;
            document.getElementById('button-width').value = btn.button_width || 1;
            document.getElementById('sort-order').value = btn.sort_order || 0;
            document.getElementById('is-active').checked = btn.is_active === 1 || btn.is_active === true;

            this.toggleActionFields(btn.url ? 'url' : 'callback');
            document.getElementById('delete-button-btn').classList.remove('hidden');
        }

        toggleActionFields(type) {
            document.getElementById('callback-data-group').classList.toggle('hidden', type !== 'callback');
            document.getElementById('url-group').classList.toggle('hidden', type !== 'url');
        }

        toggleNewActionFields(type) {
            document.getElementById('new-callback-data-group').classList.toggle('hidden', type !== 'callback');
            document.getElementById('new-url-group').classList.toggle('hidden', type !== 'url');
        }

        async saveButtonProperties() {
            if (!this.selectedButton) { showToast('warning', '–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–æ–ø–∫—É'); return; }

            const data = {
                text: document.getElementById('button-text').value,
                callback_data: document.getElementById('action-type').value === 'callback' ? document.getElementById('callback-data').value : null,
                url: document.getElementById('action-type').value === 'url' ? document.getElementById('button-url').value : null,
                row_position: parseInt(document.getElementById('row-position').value) || 0,
                column_position: parseInt(document.getElementById('column-position').value) || 0,
                button_width: parseInt(document.getElementById('button-width').value) || 1,
                sort_order: parseInt(document.getElementById('sort-order').value) || 0,
                is_active: document.getElementById('is-active').checked
            };

            try {
                const resp = await fetch(`/api/button-configs/${this.selectedButton.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
                    body: JSON.stringify(data)
                });
                const result = await resp.json();
                if (result.success) { showToast('success', '–ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞'); this.loadButtons(); }
                else { showToast('danger', '–û—à–∏–±–∫–∞: ' + result.error); }
            } catch (e) { showToast('danger', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
        }

        showAddModal() {
            document.getElementById('new-button-id').value = '';
            document.getElementById('new-button-text').value = '';
            document.getElementById('new-callback-data').value = '';
            document.getElementById('new-button-url').value = '';
            document.getElementById('new-action-type').value = 'callback';
            document.getElementById('new-button-width').value = '1';
            this.toggleNewActionFields('callback');
            openModal('addButtonModal');
        }

        async addNewButton() {
            const buttonId = document.getElementById('new-button-id').value.trim();
            const text = document.getElementById('new-button-text').value.trim();
            if (!buttonId || !text) { showToast('warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ ID –∏ —Ç–µ–∫—Å—Ç'); return; }

            const data = {
                menu_type: this.currentMenuType,
                button_id: buttonId,
                text: text,
                callback_data: document.getElementById('new-action-type').value === 'callback' ? document.getElementById('new-callback-data').value : null,
                url: document.getElementById('new-action-type').value === 'url' ? document.getElementById('new-button-url').value : null,
                row_position: 0,
                column_position: 0,
                button_width: parseInt(document.getElementById('new-button-width').value) || 1
            };

            try {
                const resp = await fetch('/api/button-configs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
                    body: JSON.stringify(data)
                });
                const result = await resp.json();
                if (result.success) { closeModal('addButtonModal'); showToast('success', '–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞'); this.loadButtons(); }
                else { showToast('danger', '–û—à–∏–±–∫–∞: ' + result.error); }
            } catch (e) { showToast('danger', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
        }

        async deleteButton(buttonId) {
            const id = buttonId || (this.selectedButton ? this.selectedButton.id : null);
            if (!id) return;
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–Ω–æ–ø–∫—É?')) return;

            try {
                const resp = await fetch(`/api/button-configs/${id}`, { method: 'DELETE', headers: { 'X-CSRFToken': getCsrfToken() } });
                const result = await resp.json();
                if (result.success) {
                    this.selectedButton = null;
                    document.getElementById('delete-button-btn').classList.add('hidden');
                    showToast('success', '–ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                    this.loadButtons();
                } else { showToast('danger', '–û—à–∏–±–∫–∞: ' + result.error); }
            } catch (e) { showToast('danger', '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
        }

        async saveLayout() {
            this.updateButtonPositions();
            let success = true;
            for (const btn of this.buttons) {
                try {
                    await fetch(`/api/button-configs/${btn.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
                        body: JSON.stringify({ row_position: btn.row_position, column_position: btn.column_position, sort_order: btn.sort_order, is_active: btn.is_active })
                    });
                } catch (e) { success = false; }
            }
            if (success) { showToast('success', '–†–∞—Å–∫–ª–∞–¥–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞'); } else { showToast('warning', '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å'); }
        }

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
        showPreview() {
            if (this.isPreviewLoading) return;
            this.isPreviewLoading = true;

            const area = document.getElementById('preview-area');
            area.innerHTML = '<div class="preview-loading"><div class="spinner"></div><p class="text-white/50 text-sm">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞...</p></div>';

            setTimeout(() => {
                const visible = this.buttons.filter(b => b.is_active === 1 || b.is_active === true);

                if (visible.length === 0) {
                    area.innerHTML = '<p class="text-white/50 text-center text-sm py-4">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>';
                    this.isPreviewLoading = false;
                    return;
                }

                // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–Ω—é
                const menuTitles = {
                    'main_menu': { title: 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', subtitle: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:' },
                    'admin_menu': { title: '‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å', subtitle: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:' },
                    'profile_menu': { title: 'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å', subtitle: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º:' },
                    'support_menu': { title: 'üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞', subtitle: '–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:' }
                };
                const menuInfo = menuTitles[this.currentMenuType] || menuTitles['main_menu'];

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ —Å—Ç—Ä–æ–∫–∞–º
                const rows = {};
                visible.forEach(btn => {
                    const row = btn.row_position || 0;
                    if (!rows[row]) rows[row] = [];
                    rows[row].push(btn);
                });

                let html = `
                    <div class="telegram-header">
                        <div class="telegram-title">${menuInfo.title}</div>
                        <div class="telegram-subtitle">${menuInfo.subtitle}</div>
                    </div>
                    <div class="telegram-button-grid">
                `;

                Object.keys(rows).sort((a, b) => a - b).forEach(row => {
                    html += '<div class="telegram-button-row">';
                    rows[row].sort((a, b) => (a.column_position || 0) - (b.column_position || 0)).forEach(btn => {
                        const width = btn.button_width || 1;
                        const flexStyle = width === 1 ? 'flex: 1;' : `flex: ${Math.min(width, 2)};`;

                        html += `
                            <div class="telegram-button" style="${flexStyle} min-width: 0;" 
                                 onclick="buttonConstructor.handlePreviewClick('${btn.callback_data || ''}', '${btn.url || ''}', '${btn.text}')">
                                <div class="telegram-button-content">
                                    <span class="telegram-button-text">${btn.text || btn.button_id}</span>
                                    ${btn.url ? '<span class="telegram-button-url">üîó</span>' : ''}
                                    ${width > 1 ? `<span class="telegram-button-width">${width}√ó</span>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                });

                html += '</div>';
                area.innerHTML = html;
                this.isPreviewLoading = false;
            }, 300);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        handlePreviewClick(callbackData, url, text) {
            if (url) {
                if (confirm(`–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É?\n\nURL: ${url}`)) {
                    window.open(url, '_blank');
                }
            } else {
                const description = this.getCallbackDescription(callbackData);
                alert(`–î–µ–π—Å—Ç–≤–∏–µ –∫–Ω–æ–ø–∫–∏:\n\n${description}\n\nCallback: ${callbackData || '–ù–µ —É–∫–∞–∑–∞–Ω'}`);
            }
        }

        // –û–ø–∏—Å–∞–Ω–∏—è callback'–æ–≤
        getCallbackDescription(callbackData) {
            if (!callbackData) return '–ù–µ —É–∫–∞–∑–∞–Ω callback';

            const descriptions = {
                'main_menu': 'üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
                'profile': 'üë§ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                'my_keys': 'üîë –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏ –∫–ª—é—á–∏',
                'buy_key': 'üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á',
                'top_up_balance': 'üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å',
                'referral_program': 'ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
                'support': 'üÜò –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏',
                'about': '‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ',
                'speed_test': '‚ö° –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏',
                'how_to_use': '‚ùì –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å',
                'admin_panel': '‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å',
                'admin_users': 'üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',
                'admin_keys': 'üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏',
                'admin_settings': '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã',
                'back_to_menu': '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é',
                'support_new_ticket': 'üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ',
                'support_my_tickets': 'üìã –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è'
            };

            if (descriptions[callbackData]) return descriptions[callbackData];

            for (const [key, desc] of Object.entries(descriptions)) {
                if (callbackData.startsWith(key)) return desc;
            }

            return `Callback: ${callbackData}`;
        }

        clearPreview() {
            document.getElementById('preview-area').innerHTML = '<p class="text-white/50 text-center text-sm">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–Ω–æ–ø–æ–∫</p>';
            this.isPreviewLoading = false;
        }
    }

    const buttonConstructor = new ButtonConstructor();
</script>
{% endblock %}